{% extends "layout.html" %}

{% block title %}Saved Citations{% endblock %}

{% block body %}
<h1>Saved Citations</h1>

<p>Search citations <a href="{{ url_for('citations_search') }}" style="font-size:18px;">here</a></p>
<p>Create new citations <a href="{{ url_for('index') }}" style="font-size:18px;">here</a></p>

{% if citations %}
{% for c in citations %}
<div class="citation" id="{{ c.id }}-{{c.citation_key}}">
  <p>@{{ c.entry_type }} &mdash; {{ c.citation_key }}: {{ c.to_human_readable() }}</p>
  <br>
  <form method="GET" action="{{ url_for('edit_citation', citation_id=c.id) }}" style="display:inline;">
    <button type="submit">Edit</button>
  </form>
  <form method="POST" action="{{ url_for('delete_citation', citation_id=c.id) }}" style="display:inline;">
    <button type="submit" onclick="return confirm('Are you sure you want to delete this citation?')">Delete</button>
  </form>
  <form method="GET" action="{{ url_for('show_bibtex', citation_id=c.id) }}" style="display:inline;">
    <button type="submit">View BibTeX</button>
  </form>
  <input type="checkbox" id="{{ c.id }}">
</div>
{% endfor %}

<h1>Export selected citations as .bib file</h1>
<form name="exportform" method="GET" action="{{ url_for('export_bibtex') }}">
  <button type="button" onclick="export_bibtex()">Export</button>
</form>

<script>
  function export_bibtex() {
    const form = document.forms['exportform'];
    const selectedIds = [];
    document.querySelectorAll('input[type="checkbox"]:checked').forEach(function(checkbox) {
      selectedIds.push(checkbox.id);
    });
    if (selectedIds.length === 0) {
      alert('Please select at least one citation to export.');
      return;
    }
    while (form.lastChild) {
      if (form.lastChild.name === 'citation_ids') {
        form.removeChild(form.lastChild);
      }
      else {
        break;
      }
    }
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'citation_ids';
    input.value = selectedIds;
    form.appendChild(input);
    form.submit();
  }
</script>
{% else %}
<p>No saved citations yet.</p>
{% endif %}
{% endblock %}
